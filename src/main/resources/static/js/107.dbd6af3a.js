(self["webpackChunklight_merge_web"]=self["webpackChunklight_merge_web"]||[]).push([[107],{1945:function(e,t,a){"use strict";var n=a(3545),l={"text/plain":"Text","text/html":"Url",default:"Text"},o="Copy to clipboard: #{key}, Enter";function r(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}function c(e,t){var a,c,s,u,i,p,d=!1;t||(t={}),a=t.debug||!1;try{s=n(),u=document.createRange(),i=document.getSelection(),p=document.createElement("span"),p.textContent=e,p.ariaHidden="true",p.style.all="unset",p.style.position="fixed",p.style.top=0,p.style.clip="rect(0, 0, 0, 0)",p.style.whiteSpace="pre",p.style.webkitUserSelect="text",p.style.MozUserSelect="text",p.style.msUserSelect="text",p.style.userSelect="text",p.addEventListener("copy",(function(n){if(n.stopPropagation(),t.format)if(n.preventDefault(),"undefined"===typeof n.clipboardData){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=l[t.format]||l["default"];window.clipboardData.setData(o,e)}else n.clipboardData.clearData(),n.clipboardData.setData(t.format,e);t.onCopy&&(n.preventDefault(),t.onCopy(n.clipboardData))})),document.body.appendChild(p),u.selectNodeContents(p),i.addRange(u);var m=document.execCommand("copy");if(!m)throw new Error("copy command was unsuccessful");d=!0}catch(g){a&&console.error("unable to copy using execCommand: ",g),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),d=!0}catch(g){a&&console.error("unable to copy using clipboardData: ",g),a&&console.error("falling back to prompt"),c=r("message"in t?t.message:o),window.prompt(c,e)}}finally{i&&("function"==typeof i.removeRange?i.removeRange(u):i.removeAllRanges()),p&&document.body.removeChild(p),s()}return d}e.exports=c},3545:function(e,t,a){a(560),e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,a=[],n=0;n<e.rangeCount;n++)a.push(e.getRangeAt(n));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||a.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},8107:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return H}});a(560);var n=a(3396),l=a(7139),o=a(4870),r=a(949),c=a(4471),s={merge(e){return(0,c.Z)({method:"post",url:"/api/merges",data:e})},checkConflicts(e){return(0,c.Z)({method:"post",url:"/api/checkConflicts",data:e})}},u=a(1945),i=a.n(u),p=a(2510),d={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},m=d,g=a(8144);function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},n=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){f(e,t,a[t])}))}return e}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var h=function(e,t){var a=v({},e,t.attrs);return(0,n.Wm)(g.Z,v({},a,{icon:m}),null)};h.displayName="SyncOutlined",h.inheritAttrs=!1;var w=h,b=a(593),y=a(923),C=a(4476),k=a(2074);const x=(0,n._)("span",{style:{"font-size":"9pt","font-weight":"bold"}},"Merged branches : ",-1),N=["onClick"],S={style:{"margin-top":"10px"}},_={style:{"text-align":"right"}},D={style:{"text-align":"right","margin-top":"10px"}},U={style:{"margin-top":"10px"}};var W={__name:"index",props:["projectName"],setup(e){const t=e,a=(0,o.iH)({}),c=(0,o.iH)([]),u=(0,o.iH)([]),d=["pink","red","orange","green","cyan","blue","purple"],m=(0,o.iH)(!1),g=(0,o.iH)(""),v=(0,o.iH)(""),f=(0,o.iH)(""),h=(0,o.iH)([]),W=(0,o.iH)({}),j=(0,o.iH)(!1),H=(0,o.iH)(new Map);function O(){console.log(v.value),console.log(f.value),void 0==g.value||""==g.value?v.value="error":v.value="",0==h.value.length?f.value="error":f.value=""}function E(e){const l="mergeLoading";C.Z.open({message:"合并中",key:l,icon:()=>(0,n.h)(p.Z,{style:"color: #108ee9",spin:!0}),duration:0}),H.value[e]=!0,console.log(e+"："+H.value[e]);let o=a.value[e].currentBranches,r={branchNames:o,projectName:t.projectName,swimlaneName:e};s.merge(r).then((t=>{H.value[e]=!1,H.value.set(e,!1),console.log(e+"："+H.value[e]),t.success?(C.Z.success({message:"合并成功",key:l,duration:3}),R()):C.Z.error({message:"失败",description:t.msg,key:l,duration:0})}))}function Z(e){switch(e){case"SUCCESS":return"success";case"loadding":return"processing";default:return"error"}}function A(e){h.value=a.value[e].selectedBranches.map((e=>e.branchName)),console.log(a.value[e].selectedBranches.map((e=>e.branchName))),g.value="",m.value=!0,O()}function B(){if(void 0==g.value||""==g.value)return;if(0==h.value.length)return;W.value=h.value.map((e=>({branchName:e,status:"loadding"})));let e={branches:h.value,baseBranch:g.value,projectName:t.projectName};s.checkConflicts(e).then((function(e){console.log(e);let t=[];for(let a of Object.keys(e.data)){let n=e.data[a];t.push({branchName:a,status:n}),console.log({branchName:a,status:n})}W.value=t}))}function M(e){i()(e),k.ZP.success("分支名称已复制")}function R(){j.value=!0,r.Z.getProject(t.projectName).then((function(e){for(let t of Object.keys(e.swimlaneMap))e.swimlaneMap[t].currentBranches=e.swimlaneMap[t].selectedBranches.map((e=>e.branchName)),H.value[t]=!1,console.log(H.value[t]);a.value=e.swimlaneMap,console.log(e.swimlaneMap),j.value=!1,k.ZP.success("项目信息加载成功")})),r.Z.getBranchs(t.projectName).then((function(e){c.value=e,console.log(e),u.value=e.map(P),console.log(e.map(P))}))}function P(e){return console.log(e),{label:e.branchName,value:e.branchName}}return(0,n.bv)((()=>R())),(t,r)=>{const c=(0,n.up)("a-col"),s=(0,n.up)("a-tag"),i=(0,n.up)("a-space"),p=(0,n.up)("a-row"),C=(0,n.up)("a-select"),k=(0,n.up)("a-button"),H=(0,n.up)("a-card"),P=(0,n.up)("a-drawer"),z=(0,n.up)("a-float-button");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("h1",null,(0,l.zw)(e.projectName),1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.value,((e,a)=>((0,n.wg)(),(0,n.j4)(H,{class:"swimlane",key:a,title:a,headStyle:"padding: 15px;",bodyStyle:"padding: 15px",style:{"margin-top":"20px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(p,null,{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[x])),_:1}),(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.selectedBranches,((e,t)=>((0,n.wg)(),(0,n.iD)("span",{key:e.branchName,onClick:t=>M(e.branchName)},[(0,n.Wm)(s,{color:d[t%d.length],bordered:!1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(e.branchName),1)])),_:2},1032,["color"])],8,N)))),128))])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,n._)("div",S,[(0,n.Wm)(C,{value:e.currentBranches,"onUpdate:value":t=>e.currentBranches=t,mode:"multiple",style:{width:"100%"},placeholder:"Select Item...","max-tag-text-length":t.maxTagTextLength,options:u.value},null,8,["value","onUpdate:value","max-tag-text-length","options"])]),(0,n._)("div",_,[(0,n.Wm)(i,{style:{"margin-top":"10px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{onClick:e=>A(a)},{default:(0,n.w5)((()=>[(0,n.Uk)("Check")])),_:2},1032,["onClick"]),(0,n.Wm)(k,{primary:"",onClick:e=>E(a)},{default:(0,n.w5)((()=>[(0,n.Uk)("Merge")])),_:2},1032,["onClick"])])),_:2},1024)])])),_:2},1032,["title"])))),128)),(0,n.Wm)(P,{open:m.value,"onUpdate:open":r[5]||(r[5]=e=>m.value=e),class:"custom-class","root-class-name":"root-class-name","root-style":{color:"blue"},style:{color:"red"},title:"Find Conflicts",placement:"right",onAfterOpenChange:t.afterOpenChange},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{value:g.value,"onUpdate:value":r[0]||(r[0]=e=>g.value=e),mode:"signal",style:{width:"100%"},placeholder:"选择基础分支",onChange:r[1]||(r[1]=e=>O()),status:v.value,options:u.value,"show-search":""},null,8,["value","status","options"]),(0,n.Wm)(C,{value:h.value,"onUpdate:value":r[2]||(r[2]=e=>h.value=e),mode:"multiple",style:{width:"100%","margin-top":"10px"},placeholder:"选择比对分支",onChange:r[3]||(r[3]=e=>O()),status:f.value,options:u.value,"show-search":""},null,8,["value","status","options"]),(0,n._)("div",D,[(0,n.Wm)(k,{onClick:r[4]||(r[4]=e=>B()),disabled:"error"==f.value||"error"==v.value},{default:(0,n.w5)((()=>[(0,n.Uk)("Check")])),_:1},8,["disabled"])]),(0,n._)("div",U,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(W.value,(e=>((0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(s,{color:Z(e.status),style:{width:"100%","margin-top":"5px"}},{icon:(0,n.w5)((()=>[(0,n.Wm)((0,o.SU)(w),{spin:!0,hidden:"loadding"!=e.status},null,8,["hidden"]),(0,n.Wm)((0,o.SU)(b.Z),{hidden:"loadding"==e.status||"SUCCESS"==e.status},null,8,["hidden"]),(0,n.Wm)((0,o.SU)(y.Z),{hidden:"loadding"==e.status||"SUCCESS"!=e.status},null,8,["hidden"])])),default:(0,n.w5)((()=>[(0,n.Uk)(" "+(0,l.zw)(e.branchName),1)])),_:2},1032,["color"])])))),256))])])),_:1},8,["open","onAfterOpenChange"]),(0,n.Wm)(z,{onClick:R},{icon:(0,n.w5)((()=>[(0,n.Wm)((0,o.SU)(w),{spin:j.value[t.swimlaneName]},null,8,["spin"])])),_:1})],64)}}};const j=W;var H=j}}]);
//# sourceMappingURL=107.dbd6af3a.js.map